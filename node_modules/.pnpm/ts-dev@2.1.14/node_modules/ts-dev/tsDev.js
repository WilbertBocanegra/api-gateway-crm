#!/usr/bin/env node --unhandled-rejections=strict --no-warnings --enable-source-maps --experimental-specifier-resolution=node
import fs from 'node:fs/promises';
import path from 'path';
import typescript from 'typescript';
import { once } from 'events';
import { spawn } from 'child_process';
import { fileURLToPath } from 'url';
import { inspect } from 'util';
import npmLogger from './npmLogger';
import npmRequire from './npmRequire';
function isString(s) {
    return typeof s === 'string';
}
async function fsStat(path) {
    try {
        return await fs.stat(path);
    }
    catch (e) {
        if (e.code === 'ENOENT') {
            return undefined;
        }
        throw e;
    }
}
class TypescriptDevelopmentTool {
    constructor() {
        Object.defineProperty(this, "logger", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: npmLogger('ts-dev')
        });
        Object.defineProperty(this, "compilerOptions", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "clean", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: this.prebuild
        });
        const configFilePath = typescript.findConfigFile('.', typescript.sys.fileExists);
        if (!configFilePath) {
            throw new Error('Unable to find project config file.');
        }
        const readConfigFileResult = typescript.parseJsonSourceFileConfigFileContent(typescript.readJsonConfigFile(configFilePath, typescript.sys.readFile), typescript.sys, './');
        if (readConfigFileResult.errors.length) {
            throw new Error(`Unable to read project config file [${configFilePath}]. ${inspect(readConfigFileResult.errors)}`);
        }
        const compilerOptions = readConfigFileResult.options;
        if (!compilerOptions) {
            throw new Error(`Unable to get compilerOptions from project config file [${configFilePath}].`);
        }
        compilerOptions.configFilePath = configFilePath;
        this.compilerOptions = compilerOptions;
    }
    async main() {
        const lifecycleEvent = process.env.npm_lifecycle_event;
        if (!lifecycleEvent) {
            this.logger.warn('Runned outside npm');
            return;
        }
        const rawLifecycleEvent = lifecycleEvent.split(':')[0];
        const method = this[rawLifecycleEvent];
        if (!method) {
            this.logger.error(`Unknown npm lifecycle [${lifecycleEvent}]`);
            return process.exit(1);
        }
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        return method.call(this);
    }
    // TODO - lint
    // TODO - compile
    // TODO - build = (lint+compile) &&
    async loadAndParseJson(jsonFileName) {
        const jsonContent = await fs.readFile(jsonFileName, { encoding: 'utf8' });
        return JSON.parse(jsonContent);
    }
    async prebuild() {
        if (this.compilerOptions.outDir) {
            fs.rmdir(this.compilerOptions.outDir, { recursive: true });
            this.logger.info(`Directory [${this.compilerOptions.outDir}] has been erased`);
        }
        if (this.compilerOptions.declarationDir) {
            fs.rmdir(this.compilerOptions.declarationDir, { recursive: true });
            this.logger.info(`Directory [${this.compilerOptions.declarationDir}] has been erased`);
        }
        const tsBuildInfoFile = typescript.getTsBuildInfoEmitOutputFilePath(this.compilerOptions);
        if (tsBuildInfoFile && await fsStat(tsBuildInfoFile)) {
            await fs.unlink(tsBuildInfoFile);
            this.logger.info(`File [${tsBuildInfoFile}] has been erased`);
        }
        return 0;
    }
    async build() {
        // Creating "dist/esm" folder
        if (this.compilerOptions.outDir) {
            if (!await fsStat(this.compilerOptions.outDir)) {
                await fs.mkdir(this.compilerOptions.outDir, { recursive: true });
                this.logger.info(`Folder [${this.compilerOptions.outDir}] has been created`);
            }
        }
        if (this.compilerOptions.declarationDir) {
            if (this.compilerOptions.declarationDir && !await fsStat(this.compilerOptions.declarationDir)) {
                fs.mkdir(this.compilerOptions.declarationDir, { recursive: true });
                this.logger.info(`Folder [${this.compilerOptions.declarationDir}] has been created`);
            }
        }
        /*
        // Use rootDirs to join inside dist
        if (this.rootDirs) {
          const rootDir = this.rootDir;
          if (!rootDir) {
            this.logger.error('Cannot join rootDirs without rootDir');
            return process.exit(9);
          }
          const distDirs = this.rootDirs.map(rd => path.resolve(this.outDir, path.relative(rootDir, rd)));
          this.logger.info(`TODO - Join distDirs [${distDirs}] inside rootDir [${rootDir}]`);
        }
          */
        if (this.compilerOptions.outDir) {
            const npmPacklist = npmRequire('npm-packlist');
            const excludedRootfiles = [
                'package.json',
                'tsconfig.json',
            ];
            const excludedPaths = [
                this.compilerOptions.rootDir,
                this.compilerOptions.outDir,
                this.compilerOptions.declarationDir,
                typescript.getTsBuildInfoEmitOutputFilePath(this.compilerOptions),
            ].filter(isString);
            const files = (await npmPacklist({ path: '.', })).filter(f => !/(?:^|\/)\./.test(f) &&
                !excludedRootfiles.includes(f) &&
                !excludedPaths.some(p => f.startsWith(p)));
            const dirs = [];
            for (const f of files) {
                const destinationFilePath = path.resolve(this.compilerOptions.outDir, f);
                const destinationDirectory = path.dirname(destinationFilePath);
                if (!dirs.includes(destinationDirectory)) {
                    await fs.mkdir(destinationDirectory, { recursive: true });
                    dirs.push(destinationDirectory);
                }
                await fs.copyFile(f, destinationFilePath);
                this.logger.info(`File [${f}] has been copied`);
            }
        }
        return await this.createPackageJson();
    }
    async createPackageJson() {
        // Creating package.json
        const packageJson = await this.loadAndParseJson(path.resolve('package.json'));
        const devDependencies = packageJson.devDependencies;
        delete packageJson.devDependencies;
        delete packageJson.scripts;
        const dist = packageJson.dist;
        if (dist !== undefined) {
            delete packageJson.dist;
            Object.assign(packageJson, dist);
        }
        if (this.compilerOptions.outDir) {
            await this.writeOutDirFiles(this.compilerOptions.outDir, packageJson);
        }
        if (this.compilerOptions.declarationDir) {
            const packageJsonName = packageJson.name;
            // name => @types/name
            // @scope/name => @scope/types__name
            const typesPackageName = packageJsonName.startsWith('@') ? packageJsonName.replace('/', '/types__') : `@types/${packageJson.name}`;
            // TODO odfiltrowane rzeczywistą listą zależności w declarationDir
            const dependencies = Object.fromEntries(Object.entries(devDependencies).filter(([packageName]) => /(?:^@types\/)|(?:\/types__)/.test(packageName)));
            const typesPackageJson = {
                name: typesPackageName,
                version: packageJson.version,
                description: `Typescript definitions for ${packageJson.name}`,
                repository: packageJson.repository,
                author: packageJson.author,
                license: packageJson.license,
                dependencies,
            };
            await this.writeOutDirFiles(this.compilerOptions.declarationDir, typesPackageJson);
        }
        return 0;
    }
    async writeOutDirFiles(dir, packageJson) {
        const distPackageJsonString = JSON.stringify(packageJson, undefined, 2);
        const distPackageJsonFilename = path.resolve(dir, 'package.json');
        await fs.writeFile(distPackageJsonFilename, distPackageJsonString);
        this.logger.info(`File [${distPackageJsonFilename}] has been created`);
        const npmIgnoreContent = [
            '/**/*.test.js',
            '/**/*.test.[cm]js',
            '/**/*.test.d.ts',
            '/test/',
        ].join('\n');
        const npmIgnoreFilename = path.resolve(dir, '.npmignore');
        await fs.writeFile(npmIgnoreFilename, npmIgnoreContent);
        this.logger.info(`File [${npmIgnoreFilename}] has been created`);
    }
    /**
     * Blokada prepack zabezpiecza również przez publish
     */
    async prepack() {
        if (process.env.npm_config_argv) {
            const argv = JSON.parse(process.env.npm_config_argv);
            if (argv.cooked[0] === 'run') {
                return 0;
            }
            this.logger.error(`Use npm run ${argv.original.join(' ')}`);
        }
        return process.exit(1);
    }
    async pack() {
        const createPack = async (dir) => {
            if (!dir) {
                return false;
            }
            const npmProcess = spawn('npm', ['pack', path.resolve(dir)], { shell: true, stdio: 'inherit' });
            const [exitCode] = await once(npmProcess, 'close');
            if (exitCode) {
                process.exit(exitCode);
            }
            this.logger.info(`The package from output directory [${this.compilerOptions.outDir}] has been packed`);
            return true;
        };
        if (![
            await createPack(this.compilerOptions.outDir),
            await createPack(this.compilerOptions.declarationDir),
        ].some(r => r)) {
            this.logger.warn('Nothing to pack');
        }
    }
    async publish() {
        if (!this.compilerOptions.outDir) {
            this.logger.warn('Nothing to publish');
            return;
        }
        // Kontrola zgoności wersji w package.json src oraz dist
        const mainPackageJson = await this.loadAndParseJson(path.resolve('package.json'));
        const distPackageJson = await this.loadAndParseJson(path.resolve(this.compilerOptions.outDir, 'package.json'));
        if (mainPackageJson.version !== distPackageJson.version) {
            this.logger.error(`Inconsistent version. Main [${mainPackageJson.version}] dist [${distPackageJson.version}]. Try build again.`);
            return process.exit(9);
        }
        const npmProcess = spawn('npm', ['publish', path.resolve(this.compilerOptions.outDir)], { shell: true, stdio: 'inherit' });
        const [exitCode] = await once(npmProcess, 'close');
        if (exitCode) {
            process.exit(exitCode);
        }
        this.logger.info(`The package from output directory [${this.compilerOptions.outDir}] has been published`);
        return 0;
    }
    async prepublishOnly() {
        if (process.env.npm_config_argv) {
            const argv = JSON.parse(process.env.npm_config_argv);
            this.logger.error(`Use npm run ${argv.original.join(' ')}`);
        }
        return process.exit(1);
    }
    /**
     * Aktualizacja projektu związana ze zmianą wersji (tj. przebudowanie package.json)
     */
    async version() {
        return await this.createPackageJson();
    }
}
if (fileURLToPath(import.meta.url) === process.argv[1]) {
    new TypescriptDevelopmentTool().main();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHNEZXYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdHNEZXYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUlBLE9BQU8sRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM5QixPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFDcEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxVQUFVLE1BQU0sY0FBYyxDQUFDO0FBRXRDLFNBQVMsUUFBUSxDQUFDLENBQXFCO0lBQ3JDLE9BQU8sT0FBTyxDQUFDLEtBQUssUUFBUSxDQUFDO0FBQy9CLENBQUM7QUFFRCxLQUFLLFVBQVUsTUFBTSxDQUFDLElBQWM7SUFDbEMsSUFBSTtRQUNGLE9BQU8sTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzVCO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFDVixJQUFJLENBQUMsQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFFO1lBQ3ZCLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO1FBQ0QsTUFBTSxDQUFDLENBQUM7S0FDVDtBQUNILENBQUM7QUFFRCxNQUFNLHlCQUF5QjtJQUs3QjtRQUhBOzs7O21CQUFpQixTQUFTLENBQUMsUUFBUSxDQUFDO1dBQUM7UUFDckM7Ozs7O1dBQW9EO1FBb0VwRDs7OzttQkFBUSxJQUFJLENBQUMsUUFBUTtXQUFDO1FBaEVwQixNQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsR0FBRyxD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LENBQUMsQ0FBQztZQUNyRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUM3RDtRQUNELE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLLENBQUMsT0FBTztRQUNsQixPQUFPLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDeEMsQ0FBQztDQUVGO0FBRUQsSUFBSSxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQ3RELElBQUkseUJBQXlCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztDQUN4QyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGUgLS11bmhhbmRsZWQtcmVqZWN0aW9ucz1zdHJpY3QgLS1uby13YXJuaW5ncyAtLWVuYWJsZS1zb3VyY2UtbWFwcyAtLWV4cGVyaW1lbnRhbC1zcGVjaWZpZXItcmVzb2x1dGlvbj1ub2RlXHJcblxyXG5pbXBvcnQgdHlwZSBOcG1QYWNrbGlzdCBmcm9tICducG0tcGFja2xpc3QnO1xyXG5pbXBvcnQgdHlwZSB7IFBhdGhMaWtlIH0gZnJvbSAnZnMnO1xyXG5pbXBvcnQgZnMgZnJvbSAnbm9kZTpmcy9wcm9taXNlcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgdHlwZXNjcmlwdCBmcm9tICd0eXBlc2NyaXB0JztcclxuaW1wb3J0IHsgb25jZSB9IGZyb20gJ2V2ZW50cyc7XHJcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XHJcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICd1cmwnO1xyXG5pbXBvcnQgeyBpbnNwZWN0IH0gZnJvbSAndXRpbCc7XHJcblxyXG5pbXBvcnQgbnBtTG9nZ2VyIGZyb20gJy4vbnBtTG9nZ2VyJztcclxuaW1wb3J0IG5wbVJlcXVpcmUgZnJvbSAnLi9ucG1SZXF1aXJlJztcclxuXHJcbmZ1bmN0aW9uIGlzU3RyaW5nKHM6IHN0cmluZyB8IHVuZGVmaW5lZCk6IHMgaXMgc3RyaW5nIHtcclxuICByZXR1cm4gdHlwZW9mIHMgPT09ICdzdHJpbmcnO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBmc1N0YXQocGF0aDogUGF0aExpa2UpIHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIGF3YWl0IGZzLnN0YXQocGF0aCk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgaWYgKGUuY29kZSA9PT0gJ0VOT0VOVCcpIHtcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHRocm93IGU7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBUeXBlc2NyaXB0RGV2ZWxvcG1lbnRUb29sIHtcclxuXHJcbiAgcHJpdmF0ZSBsb2dnZXIgPSBucG1Mb2dnZXIoJ3RzLWRldicpO1xyXG4gIHByaXZhdGUgY29tcGlsZXJPcHRpb25zOiB0eXBlc2NyaXB0LkNvbXBpbGVyT3B0aW9ucztcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgY29uc3QgY29uZmlnRmlsZVBhdGggPSB0eXBlc2NyaXB0LmZpbmRDb25maWdGaWxlKCcuJywgdHlwZXNjcmlwdC5zeXMuZmlsZUV4aXN0cyk7XHJcbiAgICBpZiAoIWNvbmZpZ0ZpbGVQYXRoKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGZpbmQgcHJvamVjdCBjb25maWcgZmlsZS4nKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZWFkQ29uZmlnRmlsZVJlc3VsdCA9IHR5cGVzY3JpcHQucGFyc2VKc29uU291cmNlRmlsZUNvbmZpZ0ZpbGVDb250ZW50KHR5cGVzY3JpcHQucmVhZEpzb25Db25maWdGaWxlKGNvbmZpZ0ZpbGVQYXRoLCB0eXBlc2NyaXB0LnN5cy5yZWFkRmlsZSksIHR5cGVzY3JpcHQuc3lzLCAnLi8nKTtcclxuXHJcbiAgICBpZiAocmVhZENvbmZpZ0ZpbGVSZXN1bHQuZXJyb3JzLmxlbmd0aCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byByZWFkIHByb2plY3QgY29uZmlnIGZpbGUgWyR7Y29uZmlnRmlsZVBhdGh9XS4gJHtpbnNwZWN0KHJlYWRDb25maWdGaWxlUmVzdWx0LmVycm9ycyl9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29tcGlsZXJPcHRpb25zID0gcmVhZENvbmZpZ0ZpbGVSZXN1bHQub3B0aW9ucztcclxuICAgIGlmICghY29tcGlsZXJPcHRpb25zKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGdldCBjb21waWxlck9wdGlvbnMgZnJvbSBwcm9qZWN0IGNvbmZpZyBmaWxlIFske2NvbmZpZ0ZpbGVQYXRofV0uYCk7XHJcbiAgICB9XHJcbiAgICBjb21waWxlck9wdGlvbnMuY29uZmlnRmlsZVBhdGggPSBjb25maWdGaWxlUGF0aDtcclxuICAgIHRoaXMuY29tcGlsZXJPcHRpb25zID0gY29tcGlsZXJPcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgbWFpbigpIHtcclxuICAgIGNvbnN0IGxpZmVjeWNsZUV2ZW50ID0gcHJvY2Vzcy5lbnYubnBtX2xpZmVjeWNsZV9ldmVudDtcclxuICAgIGlmICghbGlmZWN5Y2xlRXZlbnQpIHtcclxuICAgICAgdGhpcy5sb2dnZXIud2FybignUnVubmVkIG91dHNpZGUgbnBtJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHJhd0xpZmVjeWNsZUV2ZW50ID0gbGlmZWN5Y2xlRXZlbnQuc3BsaXQoJzonKVswXSBhcyAoa2V5b2YgdGhpcyAmIHN0cmluZyk7XHJcbiAgICBjb25zdCBtZXRob2QgPSB0aGlzW3Jhd0xpZmVjeWNsZUV2ZW50XTtcclxuICAgIGlmICghbWV0aG9kKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBVbmtub3duIG5wbSBsaWZlY3ljbGUgWyR7bGlmZWN5Y2xlRXZlbnR9XWApO1xyXG4gICAgICByZXR1cm4gcHJvY2Vzcy5leGl0KDEpO1xyXG4gICAgfVxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgIHJldHVybiAobWV0aG9kIGFzIGFueSkuY2FsbCh0aGlzKTtcclxuICB9XHJcblxyXG4gIC8vIFRPRE8gLSBsaW50XHJcbiAgLy8gVE9ETyAtIGNvbXBpbGVcclxuICAvLyBUT0RPIC0gYnVpbGQgPSAobGludCtjb21waWxlKSAmJlxyXG5cclxuICBwcml2YXRlIGFzeW5jIGxvYWRBbmRQYXJzZUpzb24oanNvbkZpbGVOYW1lOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGpzb25Db250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUoanNvbkZpbGVOYW1lLCB7IGVuY29kaW5nOiAndXRmOCcgfSk7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBwcmVidWlsZCgpIHtcclxuICAgIGlmICh0aGlzLmNvbXBpbGVyT3B0aW9ucy5vdXREaXIpIHtcclxuICAgICAgZnMucm1kaXIodGhpcy5jb21waWxlck9wdGlvbnMub3V0RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRGlyZWN0b3J5IFske3RoaXMuY29tcGlsZXJPcHRpb25zLm91dERpcn1dIGhhcyBiZWVuIGVyYXNlZGApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpcikge1xyXG4gICAgICBmcy5ybWRpcih0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYERpcmVjdG9yeSBbJHt0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpcn1dIGhhcyBiZWVuIGVyYXNlZGApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRzQnVpbGRJbmZvRmlsZSA9IHR5cGVzY3JpcHQuZ2V0VHNCdWlsZEluZm9FbWl0T3V0cHV0RmlsZVBhdGgodGhpcy5jb21waWxlck9wdGlvbnMpO1xyXG4gICAgaWYgKHRzQnVpbGRJbmZvRmlsZSAmJiBhd2FpdCBmc1N0YXQodHNCdWlsZEluZm9GaWxlKSkge1xyXG4gICAgICBhd2FpdCBmcy51bmxpbmsodHNCdWlsZEluZm9GaWxlKTtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRmlsZSBbJHt0c0J1aWxkSW5mb0ZpbGV9XSBoYXMgYmVlbiBlcmFzZWRgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIGNsZWFuID0gdGhpcy5wcmVidWlsZDtcclxuXHJcbiAgYXN5bmMgYnVpbGQoKSB7XHJcblxyXG4gICAgLy8gQ3JlYXRpbmcgXCJkaXN0L2VzbVwiIGZvbGRlclxyXG4gICAgaWYgKHRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpcikge1xyXG4gICAgICBpZiAoISBhd2FpdCBmc1N0YXQodGhpcy5jb21waWxlck9wdGlvbnMub3V0RGlyKSkge1xyXG4gICAgICAgIGF3YWl0IGZzLm1rZGlyKHRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRm9sZGVyIFske3RoaXMuY29tcGlsZXJPcHRpb25zLm91dERpcn1dIGhhcyBiZWVuIGNyZWF0ZWRgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpcikge1xyXG4gICAgICBpZiAodGhpcy5jb21waWxlck9wdGlvbnMuZGVjbGFyYXRpb25EaXIgJiYgIWF3YWl0IGZzU3RhdCh0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpcikpIHtcclxuICAgICAgICBmcy5ta2Rpcih0aGlzLmNvbXBpbGVyT3B0aW9ucy5kZWNsYXJhdGlvbkRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRm9sZGVyIFske3RoaXMuY29tcGlsZXJPcHRpb25zLmRlY2xhcmF0aW9uRGlyfV0gaGFzIGJlZW4gY3JlYXRlZGApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvKlxyXG4gICAgLy8gVXNlIHJvb3REaXJzIHRvIGpvaW4gaW5zaWRlIGRpc3RcclxuICAgIGlmICh0aGlzLnJvb3REaXJzKSB7XHJcbiAgICAgIGNvbnN0IHJvb3REaXIgPSB0aGlzLnJvb3REaXI7XHJcbiAgICAgIGlmICghcm9vdERpcikge1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdDYW5ub3Qgam9pbiByb290RGlycyB3aXRob3V0IHJvb3REaXInKTtcclxuICAgICAgICByZXR1cm4gcHJvY2Vzcy5leGl0KDkpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGRpc3REaXJzID0gdGhpcy5yb290RGlycy5tYXAocmQgPT4gcGF0aC5yZXNvbHZlKHRoaXMub3V0RGlyLCBwYXRoLnJlbGF0aXZlKHJvb3REaXIsIHJkKSkpO1xyXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBUT0RPIC0gSm9pbiBkaXN0RGlycyBbJHtkaXN0RGlyc31dIGluc2lkZSByb290RGlyIFske3Jvb3REaXJ9XWApO1xyXG4gICAgfVxyXG4gICAgICAqL1xyXG5cclxuICAgIGlmICh0aGlzLmNvbXBpbGVyT3B0aW9ucy5vdXREaXIpIHtcclxuXHJcbiAgICAgIGNvbnN0IG5wbVBhY2tsaXN0OiB0eXBlb2YgTnBtUGFja2xpc3QgPSBucG1SZXF1aXJlKCducG0tcGFja2xpc3QnKTtcclxuXHJcbiAgICAgIGNvbnN0IGV4Y2x1ZGVkUm9vdGZpbGVzID0gW1xyXG4gICAgICAgICdwYWNrYWdlLmpzb24nLFxyXG4gICAgICAgICd0c2NvbmZpZy5qc29uJyxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IGV4Y2x1ZGVkUGF0aHMgPSBbXHJcbiAgICAgICAgdGhpcy5jb21waWxlck9wdGlvbnMucm9vdERpcixcclxuICAgICAgICB0aGlzLmNvbXBpbGVyT3B0aW9ucy5vdXREaXIsXHJcbiAgICAgICAgdGhpcy5jb21waWxlck9wdGlvbnMuZGVjbGFyYXRpb25EaXIsXHJcbiAgICAgICAgdHlwZXNjcmlwdC5nZXRUc0J1aWxkSW5mb0VtaXRPdXRwdXRGaWxlUGF0aCh0aGlzLmNvbXBpbGVyT3B0aW9ucyksXHJcbiAgICAgIF0uZmlsdGVyPHN0cmluZz4oaXNTdHJpbmcpO1xyXG5cclxuICAgICAgY29uc3QgZmlsZXMgPSAoYXdhaXQgbnBtUGFja2xpc3QoeyBwYXRoOiAnLicsIH0pKS5maWx0ZXIoZiA9PlxyXG4gICAgICAgICEvKD86XnxcXC8pXFwuLy50ZXN0KGYpICYmXHJcbiAgICAgICAgIWV4Y2x1ZGVkUm9vdGZpbGVzLmluY2x1ZGVzKGYpICYmXHJcbiAgICAgICAgIWV4Y2x1ZGVkUGF0aHMuc29tZShwID0+IGYuc3RhcnRzV2l0aChwKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IGRpcnM6IHN0cmluZ1tdID0gW107XHJcbiAgICAgIGZvciAoY29uc3QgZiBvZiBmaWxlcykge1xyXG4gICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uRmlsZVBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5jb21waWxlck9wdGlvbnMub3V0RGlyLCBmKTtcclxuICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkRpcmVjdG9yeSA9IHBhdGguZGlybmFtZShkZXN0aW5hdGlvbkZpbGVQYXRoKTtcclxuICAgICAgICBpZiAoIWRpcnMuaW5jbHVkZXMoZGVzdGluYXRpb25EaXJlY3RvcnkpKSB7XHJcbiAgICAgICAgICBhd2FpdCBmcy5ta2RpcihkZXN0aW5hdGlvbkRpcmVjdG9yeSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgICBkaXJzLnB1c2goZGVzdGluYXRpb25EaXJlY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhd2FpdCBmcy5jb3B5RmlsZShmLCBkZXN0aW5hdGlvbkZpbGVQYXRoKTtcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBGaWxlIFske2Z9XSBoYXMgYmVlbiBjb3BpZWRgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNyZWF0ZVBhY2thZ2VKc29uKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZVBhY2thZ2VKc29uKCkge1xyXG5cclxuICAgIC8vIENyZWF0aW5nIHBhY2thZ2UuanNvblxyXG4gICAgY29uc3QgcGFja2FnZUpzb24gPSBhd2FpdCB0aGlzLmxvYWRBbmRQYXJzZUpzb24ocGF0aC5yZXNvbHZlKCdwYWNrYWdlLmpzb24nKSk7XHJcbiAgICBjb25zdCBkZXZEZXBlbmRlbmNpZXMgPSBwYWNrYWdlSnNvbi5kZXZEZXBlbmRlbmNpZXM7XHJcbiAgICBkZWxldGUgcGFja2FnZUpzb24uZGV2RGVwZW5kZW5jaWVzO1xyXG4gICAgZGVsZXRlIHBhY2thZ2VKc29uLnNjcmlwdHM7XHJcbiAgICBjb25zdCBkaXN0ID0gcGFja2FnZUpzb24uZGlzdDtcclxuICAgIGlmIChkaXN0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgZGVsZXRlIHBhY2thZ2VKc29uLmRpc3Q7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24ocGFja2FnZUpzb24sIGRpc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbXBpbGVyT3B0aW9ucy5vdXREaXIpIHtcclxuICAgICAgYXdhaXQgdGhpcy53cml0ZU91dERpckZpbGVzKHRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpciwgcGFja2FnZUpzb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY29tcGlsZXJPcHRpb25zLmRlY2xhcmF0aW9uRGlyKSB7XHJcblxyXG4gICAgICBjb25zdCBwYWNrYWdlSnNvbk5hbWUgPSAocGFja2FnZUpzb24ubmFtZSBhcyBzdHJpbmcpO1xyXG4gICAgICAvLyBuYW1lID0+IEB0eXBlcy9uYW1lXHJcbiAgICAgIC8vIEBzY29wZS9uYW1lID0+IEBzY29wZS90eXBlc19fbmFtZVxyXG4gICAgICBjb25zdCB0eXBlc1BhY2thZ2VOYW1lID0gcGFja2FnZUpzb25OYW1lLnN0YXJ0c1dpdGgoJ0AnKSA/IHBhY2thZ2VKc29uTmFtZS5yZXBsYWNlKCcvJywgJy90eXBlc19fJykgOiBgQHR5cGVzLyR7cGFja2FnZUpzb24ubmFtZX1gO1xyXG5cclxuICAgICAgLy8gVE9ETyBvZGZpbHRyb3dhbmUgcnplY3p5d2lzdMSFIGxpc3TEhSB6YWxlxbxub8WbY2kgdyBkZWNsYXJhdGlvbkRpclxyXG4gICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoZGV2RGVwZW5kZW5jaWVzKS5maWx0ZXIoKFtwYWNrYWdlTmFtZV0pID0+IC8oPzpeQHR5cGVzXFwvKXwoPzpcXC90eXBlc19fKS8udGVzdChwYWNrYWdlTmFtZSkpKTtcclxuXHJcbiAgICAgIGNvbnN0IHR5cGVzUGFja2FnZUpzb24gPSB7XHJcbiAgICAgICAgbmFtZTogdHlwZXNQYWNrYWdlTmFtZSxcclxuICAgICAgICB2ZXJzaW9uOiBwYWNrYWdlSnNvbi52ZXJzaW9uLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgVHlwZXNjcmlwdCBkZWZpbml0aW9ucyBmb3IgJHtwYWNrYWdlSnNvbi5uYW1lfWAsXHJcbiAgICAgICAgcmVwb3NpdG9yeTogcGFja2FnZUpzb24ucmVwb3NpdG9yeSxcclxuICAgICAgICBhdXRob3I6IHBhY2thZ2VKc29uLmF1dGhvcixcclxuICAgICAgICBsaWNlbnNlOiBwYWNrYWdlSnNvbi5saWNlbnNlLFxyXG4gICAgICAgIGRlcGVuZGVuY2llcyxcclxuICAgICAgfTtcclxuICAgICAgYXdhaXQgdGhpcy53cml0ZU91dERpckZpbGVzKHRoaXMuY29tcGlsZXJPcHRpb25zLmRlY2xhcmF0aW9uRGlyLCB0eXBlc1BhY2thZ2VKc29uKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgd3JpdGVPdXREaXJGaWxlcyhkaXI6IHN0cmluZywgcGFja2FnZUpzb246IHVua25vd24pIHtcclxuICAgIFxyXG4gICAgY29uc3QgZGlzdFBhY2thZ2VKc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkocGFja2FnZUpzb24sIHVuZGVmaW5lZCwgMik7XHJcbiAgICBjb25zdCBkaXN0UGFja2FnZUpzb25GaWxlbmFtZSA9IHBhdGgucmVzb2x2ZShkaXIsICdwYWNrYWdlLmpzb24nKTtcclxuICAgIGF3YWl0IGZzLndyaXRlRmlsZShkaXN0UGFja2FnZUpzb25GaWxlbmFtZSwgZGlzdFBhY2thZ2VKc29uU3RyaW5nKTtcclxuICAgIHRoaXMubG9nZ2VyLmluZm8oYEZpbGUgWyR7ZGlzdFBhY2thZ2VKc29uRmlsZW5hbWV9XSBoYXMgYmVlbiBjcmVhdGVkYCk7XHJcblxyXG4gICAgY29uc3QgbnBtSWdub3JlQ29udGVudCA9IFtcclxuICAgICAgJy8qKi8qLnRlc3QuanMnLFxyXG4gICAgICAnLyoqLyoudGVzdC5bY21danMnLFxyXG4gICAgICAnLyoqLyoudGVzdC5kLnRzJyxcclxuICAgICAgJy90ZXN0LycsXHJcbiAgICBdLmpvaW4oJ1xcbicpO1xyXG5cclxuICAgIGNvbnN0IG5wbUlnbm9yZUZpbGVuYW1lID0gcGF0aC5yZXNvbHZlKGRpciwgJy5ucG1pZ25vcmUnKTtcclxuICAgIGF3YWl0IGZzLndyaXRlRmlsZShucG1JZ25vcmVGaWxlbmFtZSwgbnBtSWdub3JlQ29udGVudCk7XHJcbiAgICB0aGlzLmxvZ2dlci5pbmZvKGBGaWxlIFske25wbUlnbm9yZUZpbGVuYW1lfV0gaGFzIGJlZW4gY3JlYXRlZGApO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJsb2thZGEgcHJlcGFjayB6YWJlenBpZWN6YSByw7N3bmllxbwgcHJ6ZXogcHVibGlzaFxyXG4gICAqL1xyXG4gIGFzeW5jIHByZXBhY2soKSB7XHJcbiAgICBpZiAocHJvY2Vzcy5lbnYubnBtX2NvbmZpZ19hcmd2KSB7XHJcbiAgICAgIGNvbnN0IGFyZ3YgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52Lm5wbV9jb25maWdfYXJndik7XHJcbiAgICAgIGlmIChhcmd2LmNvb2tlZFswXSA9PT0gJ3J1bicpIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgVXNlIG5wbSBydW4gJHthcmd2Lm9yaWdpbmFsLmpvaW4oJyAnKX1gKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBwYWNrKCkge1xyXG5cclxuICAgIGNvbnN0IGNyZWF0ZVBhY2sgPSBhc3luYyAoZGlyPzogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmICghZGlyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IG5wbVByb2Nlc3MgPSBzcGF3bignbnBtJywgWydwYWNrJywgcGF0aC5yZXNvbHZlKGRpcildLCB7IHNoZWxsOiB0cnVlLCBzdGRpbzogJ2luaGVyaXQnIH0pO1xyXG4gICAgICBjb25zdCBbZXhpdENvZGVdID0gYXdhaXQgb25jZShucG1Qcm9jZXNzLCAnY2xvc2UnKTtcclxuICAgICAgaWYgKGV4aXRDb2RlKSB7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KGV4aXRDb2RlKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBUaGUgcGFja2FnZSBmcm9tIG91dHB1dCBkaXJlY3RvcnkgWyR7dGhpcy5jb21waWxlck9wdGlvbnMub3V0RGlyfV0gaGFzIGJlZW4gcGFja2VkYCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghW1xyXG4gICAgICBhd2FpdCBjcmVhdGVQYWNrKHRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpciksXHJcbiAgICAgIGF3YWl0IGNyZWF0ZVBhY2sodGhpcy5jb21waWxlck9wdGlvbnMuZGVjbGFyYXRpb25EaXIpLFxyXG4gICAgXS5zb21lKHIgPT4gcikpIHtcclxuICAgICAgdGhpcy5sb2dnZXIud2FybignTm90aGluZyB0byBwYWNrJyk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcHVibGlzaCgpIHtcclxuXHJcbiAgICBpZiAoIXRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdOb3RoaW5nIHRvIHB1Ymxpc2gnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEtvbnRyb2xhIHpnb25vxZtjaSB3ZXJzamkgdyBwYWNrYWdlLmpzb24gc3JjIG9yYXogZGlzdFxyXG4gICAgY29uc3QgbWFpblBhY2thZ2VKc29uID0gYXdhaXQgdGhpcy5sb2FkQW5kUGFyc2VKc29uKHBhdGgucmVzb2x2ZSgncGFja2FnZS5qc29uJykpO1xyXG4gICAgY29uc3QgZGlzdFBhY2thZ2VKc29uID0gYXdhaXQgdGhpcy5sb2FkQW5kUGFyc2VKc29uKHBhdGgucmVzb2x2ZSh0aGlzLmNvbXBpbGVyT3B0aW9ucy5vdXREaXIsICdwYWNrYWdlLmpzb24nKSk7XHJcbiAgICBpZiAobWFpblBhY2thZ2VKc29uLnZlcnNpb24gIT09IGRpc3RQYWNrYWdlSnNvbi52ZXJzaW9uKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBJbmNvbnNpc3RlbnQgdmVyc2lvbi4gTWFpbiBbJHttYWluUGFja2FnZUpzb24udmVyc2lvbn1dIGRpc3QgWyR7ZGlzdFBhY2thZ2VKc29uLnZlcnNpb259XS4gVHJ5IGJ1aWxkIGFnYWluLmApO1xyXG4gICAgICByZXR1cm4gcHJvY2Vzcy5leGl0KDkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5wbVByb2Nlc3MgPSBzcGF3bignbnBtJywgWydwdWJsaXNoJywgcGF0aC5yZXNvbHZlKHRoaXMuY29tcGlsZXJPcHRpb25zLm91dERpcildLCB7IHNoZWxsOiB0cnVlLCBzdGRpbzogJ2luaGVyaXQnIH0pO1xyXG4gICAgY29uc3QgW2V4aXRDb2RlXSA9IGF3YWl0IG9uY2UobnBtUHJvY2VzcywgJ2Nsb3NlJyk7XHJcbiAgICBpZiAoZXhpdENvZGUpIHtcclxuICAgICAgcHJvY2Vzcy5leGl0KGV4aXRDb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmxvZ2dlci5pbmZvKGBUaGUgcGFja2FnZSBmcm9tIG91dHB1dCBkaXJlY3RvcnkgWyR7dGhpcy5jb21waWxlck9wdGlvbnMub3V0RGlyfV0gaGFzIGJlZW4gcHVibGlzaGVkYCk7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIGFzeW5jIHByZXB1Ymxpc2hPbmx5KCkge1xyXG4gICAgaWYgKHByb2Nlc3MuZW52Lm5wbV9jb25maWdfYXJndikge1xyXG4gICAgICBjb25zdCBhcmd2ID0gSlNPTi5wYXJzZShwcm9jZXNzLmVudi5ucG1fY29uZmlnX2FyZ3YpO1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgVXNlIG5wbSBydW4gJHthcmd2Lm9yaWdpbmFsLmpvaW4oJyAnKX1gKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBa3R1YWxpemFjamEgcHJvamVrdHUgendpxIV6YW5hIHplIHptaWFuxIUgd2Vyc2ppICh0ai4gcHJ6ZWJ1ZG93YW5pZSBwYWNrYWdlLmpzb24pXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIHZlcnNpb24oKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jcmVhdGVQYWNrYWdlSnNvbigpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmlmIChmaWxlVVJMVG9QYXRoKGltcG9ydC5tZXRhLnVybCkgPT09IHByb2Nlc3MuYXJndlsxXSkge1xyXG4gIG5ldyBUeXBlc2NyaXB0RGV2ZWxvcG1lbnRUb29sKCkubWFpbigpO1xyXG59XHJcblxyXG4iXX0=